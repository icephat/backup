<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
	
<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.close {display: none;}
</style>

<meta charset="UTF-8">
<jsp:include page="../layouts/mainLayout.jsp" />
<title>NaturalenemyCreate Page</title>
<jsp:include page="../layouts/mainLayoutStylesheet.jsp" />

 <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/image-uploader.min.css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,700|Montserrat:300,400,500,600,700|Source+Code+Pro&display=swap"
          rel="stylesheet">

</head>


<body>
	<div class="container-fluid">
		<div class="row justify-content-center">
			<div class="col-lg-12">
				<div class="card">
					<div class="card-body">
						<h4 class="card-title">ศัตรูธรรมชาติ > รายละเอียด</h4>
						<div class="form-validation">
							<form class="form-valide" id="data"
								
								 modelAttribute="naturalEnemyDTO" enctype = "multipart/form-data">
								<div class="form-group row">
									<label class="col-lg-4 col-form-label" for="val-username">ชื่อสามัญ<span
										class="text-danger">*</span>
									</label>
									<div class="col-lg-6">
										<input type="text" class="form-control" id="val-username"
											name="naturalEnemy.commonName" placeholder="" required>
									</div>
								</div>
								<div class="form-group row">
									<label class="col-lg-4 col-form-label" for="val-username">ชื่อวิทยาศาสตร์<span
										class="text-danger">*</span>
									</label>
									<div class="col-lg-6">
										<input type="text" class="form-control" id="val-username"
											name=naturalEnemy.scientificName placeholder="" required>
									</div>
								</div>
								<div class="form-group row">
									<label class="col-lg-4 col-form-label" for="val-username">ชนิด<span
										class="text-danger">*</span>
									</label>
									<div class="col-lg-6">
										<select name="naturalEnemy.type" id="type" class="col-lg-6"" required>
											<option value=""></option>
											<option value="ตัวห้ำ">ตัวห้ำ</option>
											<option value="ตัวเบียน">ตัวเบียน</option>
										</select>
									</div>
								</div>
								<div class="form-group row">
									<label class="col-lg-4 col-form-label" for="val-username">การควบคุม<span
										class="text-danger">*</span>
									</label>
									<div class="col-lg-6">
										<input type="text" class="form-control" id="val-username"
											name="naturalEnemy.controlMethod" placeholder="" required>
									</div>
								</div>
								<div class="form-group row">
									<label class="col-lg-4 col-form-label" for="val-username">อัตราการปล่อย<span
										class="text-danger">*</span>
									</label>
									<div class="col-lg-6">
										<input type="text" class="form-control" id="val-username"
											name="naturalEnemy.releaseRate" placeholder="" required>
									</div>
								</div>
								<div class="form-group row">
									<label class="col-lg-4 col-form-label" for="val-username">แหล่งที่มา<span
										class="text-danger">*</span>
									</label>
									<div class="col-lg-6">
										<input type="text" class="form-control" id="val-username"
											name="naturalEnemy.source" placeholder="" required>
									</div>
								</div>
								<div class="form-group row">
									<label class="col-lg-4 col-form-label" for="val-username">เลือกภาพ<span
										class="text-danger">*</span>
									</label>

									<div class="col-lg-6">
										<input type="file" class="form-control" id="nmfiles"
											name="files" placeholder="" style="display:none"  >
									</div>
									
								</div>
								
								<div class="input-field">
                					<label class="active">Photos</label>
                					<div id="input-images-2" class="input-images-2" style="padding-top: .5rem;"></div>
            					</div>
								
								<div class="form-group row">
									<div class="col-lg-8 ml-auto">
										<a
										href="${pageContext.request.contextPath }/naturalenemy/naturalenemyIndex"
											class="btn btn-light" role="button">กลับ</a> <!-- <input
											type="submit" class="btn btn-primary" role="button"
											value="บันทึก"> -->
										<button id="uploadBtn" >Upload</button>

									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	
	

  <div class="modal fade" id="myModal" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content" >
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Modal Header</h4>
        </div>
        <div class="modal-body" id="status">
          <section class="progress-area"></section>
		  <section class="uploaded-area"></section>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>

<jsp:include page="../layouts/mainLayoutContentBottom.jsp" />
<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

<script type="text/javascript" src="${pageContext.request.contextPath}/resources/js/image-uploader.min.js"></script>

<script>


    $(function () {

    	var isChange = false ;
    	
    	
    	  $("#uploadBtn").click(function() {
			  alert("test");
    	//	   $('#myModal').modal('show');
    		  
//     	       var formData = new FormData($('#data')[0]);
//     	       console.log(formData);
//     	        $.ajax({
//     	            url: "${pageContext.request.contextPath }/naturalenemy/naturalenemySave",
//     	            type: 'POST',
//     	            data: formData,
//     	            xhr: function() {
    	            	
    	             
//     	                var xhr = new window.XMLHttpRequest();
//     	                xhr.upload.addEventListener("progress", function(evt) {
//     	                    if (evt.lengthComputable) {
//     	                        var percentComplete = evt.loaded / evt.total;
//     	                        console.log(percentComplete);
//     						    //  $('#status').html('<b> Uploading -> ' + (Math.round(percentComplete * 100)) + '% </b>');
//     	                       // alert($("#data"));
//     	                    }
//     	                }, false);
//     	                return xhr;
//     	            },
//     	            success: function(data) {
//     	            	window.location.href = "${pageContext.request.contextPath }/naturalenemy/naturalenemyIndex";
//     	              //  $("#status").html('UPLOADED!!');
//     	            },
//     	            cache: false,
//     	            contentType: false,
//     	            processData: false
//     	        });
//     	        return false;
    	    });
    	

    	$('.input-images-2').bind('DOMNodeInserted DOMNodeRemoved', function(event) {
    		if (event.type == 'DOMNodeInserted' && !isChange) {
    			isChange = true ;
    			let list = new DataTransfer();
    			let fileInput = document.querySelector('#f');
    			//fileList = fileInput.files ;
    			
    			for (var i = 0; i < fileInput.files.length; i++)
    			 {
    				
    				 list.items.add(fileInput.files[i]);
    				 //alert(list.files[i].name);
    			
    			 }
    			 //alert(fileList.length);
    			 //if(list.files.length < $('input[name^=pho]')[0].files.length)
    				 for (var i = 0; i < $('input[name^=pho]')[0].files.length; i++)
    				 {
    				   list.items.add($('input[name^=pho]')[0].files[i]);
    				 }

    			 //alert(list.files.length);
    			
    			 fileInput.prop('files', list.files);
    			 //fileInput.files =$('input[name^=pho]')[0].files ;
    			// fileInput.files = new FileListItems(list.files) ;
    		} else  {
    			//isChange = true ;
    			let fileInput = document.querySelector('#nmfiles');
    			fileInput.files =$('input[name^=pho]')[0].files ;
    			//alert('Content removed! Current content:' + '\n\n' + this.innerHTML);
    		}
    	});
           
    	
    	$( ".input-images-2" ).mouseover(function() {
    		if(isChange){
    			let fileInput = document.querySelector('#nmfiles');
    			fileInput.files =$('input[name^=pho]')[0].files ;
    		}
      		isChange = false ;
      		
    	});
    	

        let preloaded = [
            //{id: 1, src: 'https://picsum.photos/500/500?random=1'},
            //{id: 2, src: 'https://picsum.photos/500/500?random=2'},
            //{id: 3, src: 'https://picsum.photos/500/500?random=3'},
            //{id: 4, src: 'https://picsum.photos/500/500?random=4'},
            //{id: 5, src: 'https://picsum.photos/500/500?random=5'},
            //{id: 6, src: 'https://picsum.photos/500/500?random=6'},
        ];

        $('.input-images-2').imageUploader({
            preloaded: preloaded,
            imagesInputName: 'photos',
            preloadedInputName: 'old',
            maxSize: 2 * 1024 * 1024,
            maxFiles: 10
        });
        


        // Input and label handler
        $('input').on('focus', function () {
            $(this).parent().find('label').addClass('active')
        }).on('blur', function () {
            if ($(this).val() == '') {
                $(this).parent().find('label').removeClass('active');
            }
        });

        // Sticky menu
        let $nav = $('nav'),
            $header = $('header'),
            offset = 4 * parseFloat($('body').css('font-size')),
            scrollTop = $(this).scrollTop();

        // Initial verification
        setNav();

        // Bind scroll
        $(window).on('scroll', function () {
            scrollTop = $(this).scrollTop();
            // Update nav
            setNav();
        });

        function setNav() {
            if (scrollTop > $header.outerHeight()) {
                $nav.css({position: 'fixed', 'top': offset});
            } else {
                $nav.css({position: '', 'top': ''});
            }
        }
    });
</script>
</body>
<jsp:include page="../layouts/mainLayoutScript.jsp" />
</html>